<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>조직도 | Liteware</title>
    <!-- OrgChart CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/orgchart@3.1.3/dist/css/jquery.orgchart.min.css">
    <style>
        .orgchart { background: white; }
        .orgchart .node { border: 2px solid #3498db; background: white; }
        .orgchart .node:hover { background-color: #e3f2fd; }
        .orgchart .node .title { background-color: #3498db; color: white; font-weight: bold; }
        .orgchart .node .content { padding: 10px; font-size: 14px; }
        .user-card { 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 10px; 
            margin-bottom: 10px; 
            cursor: pointer;
            transition: all 0.3s;
        }
        .user-card:hover { 
            background-color: #f8f9fa; 
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .dept-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            border-radius: 5px 5px 0 0;
        }
        #orgChart { 
            overflow: auto; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <!-- Content Header -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">조직도</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/">홈</a></li>
                        <li class="breadcrumb-item active">조직도</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
    <!-- 탭 메뉴 -->
    <div class="card card-primary card-tabs">
        <div class="card-header p-0 pt-1">
            <ul class="nav nav-tabs" id="org-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#chart-view" data-toggle="tab">
                        <i class="fas fa-sitemap"></i> 조직도
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#list-view" data-toggle="tab">
                        <i class="fas fa-list"></i> 부서별 목록
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#directory" data-toggle="tab">
                        <i class="fas fa-address-book"></i> 주소록
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="card-body">
            <div class="tab-content">
                <!-- 조직도 뷰 -->
                <div class="tab-pane fade show active" id="chart-view">
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-outline-primary" onclick="expandAll()">
                                    <i class="fas fa-expand"></i> 전체 펼치기
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="collapseAll()">
                                    <i class="fas fa-compress"></i> 전체 접기
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="exportChart()">
                                    <i class="fas fa-download"></i> 내보내기
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="orgChart">
                        <!-- 조직도가 여기에 렌더링됨 -->
                    </div>
                </div>
                
                <!-- 부서별 목록 뷰 -->
                <div class="tab-pane fade" id="list-view">
                    <div class="row">
                        <!-- 경영지원본부 -->
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="dept-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-building"></i> 경영지원본부
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <h6>인사팀</h6>
                                    <div class="user-card" onclick="showUserDetail(1)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>김철수</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">kim@company.com</small>
                                    </div>
                                    <div class="user-card" onclick="showUserDetail(2)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>이영희</strong>
                                                <span class="badge badge-info ml-1">과장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">lee@company.com</small>
                                    </div>
                                    
                                    <h6 class="mt-3">총무팀</h6>
                                    <div class="user-card" onclick="showUserDetail(3)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>박민수</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">park@company.com</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- IT본부 -->
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="dept-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-laptop-code"></i> IT본부
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <h6>개발팀</h6>
                                    <div class="user-card" onclick="showUserDetail(4)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>정수진</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">jung@company.com</small>
                                    </div>
                                    <div class="user-card" onclick="showUserDetail(5)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>최동욱</strong>
                                                <span class="badge badge-info ml-1">과장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">choi@company.com</small>
                                    </div>
                                    
                                    <h6 class="mt-3">인프라팀</h6>
                                    <div class="user-card" onclick="showUserDetail(6)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>강민호</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">kang@company.com</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 영업본부 -->
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="dept-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-handshake"></i> 영업본부
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <h6>국내영업팀</h6>
                                    <div class="user-card" onclick="showUserDetail(7)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>황지현</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">hwang@company.com</small>
                                    </div>
                                    
                                    <h6 class="mt-3">해외영업팀</h6>
                                    <div class="user-card" onclick="showUserDetail(8)">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong>손민정</strong>
                                                <span class="badge badge-primary ml-1">팀장</span>
                                            </div>
                                            <div>
                                                <i class="fas fa-phone text-muted"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted">son@company.com</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 주소록 뷰 -->
                <div class="tab-pane fade" id="directory">
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="이름, 부서, 직급으로 검색" id="searchInput">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button" onclick="searchDirectory()">
                                        <i class="fas fa-search"></i> 검색
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>이름</th>
                                    <th>부서</th>
                                    <th>직급</th>
                                    <th>이메일</th>
                                    <th>연락처</th>
                                    <th>내선번호</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="directoryTable">
                                <tr>
                                    <td>김철수</td>
                                    <td>인사팀</td>
                                    <td>팀장</td>
                                    <td>kim@company.com</td>
                                    <td>010-1234-5678</td>
                                    <td>1234</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" onclick="showUserDetail(1)">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>이영희</td>
                                    <td>인사팀</td>
                                    <td>과장</td>
                                    <td>lee@company.com</td>
                                    <td>010-2345-6789</td>
                                    <td>1235</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" onclick="showUserDetail(2)">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>박민수</td>
                                    <td>총무팀</td>
                                    <td>팀장</td>
                                    <td>park@company.com</td>
                                    <td>010-3456-7890</td>
                                    <td>1236</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" onclick="showUserDetail(3)">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </section>
</div>

<!-- 사용자 상세 정보 모달 -->
<div class="modal fade" id="userDetailModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">직원 정보</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img src="https://via.placeholder.com/150" class="rounded-circle" alt="Profile">
                </div>
                <table class="table table-bordered">
                    <tr>
                        <th style="width: 30%">이름</th>
                        <td id="modalName">김철수</td>
                    </tr>
                    <tr>
                        <th>부서</th>
                        <td id="modalDept">인사팀</td>
                    </tr>
                    <tr>
                        <th>직급</th>
                        <td id="modalPosition">팀장</td>
                    </tr>
                    <tr>
                        <th>이메일</th>
                        <td id="modalEmail">kim@company.com</td>
                    </tr>
                    <tr>
                        <th>연락처</th>
                        <td id="modalPhone">010-1234-5678</td>
                    </tr>
                    <tr>
                        <th>내선번호</th>
                        <td id="modalExt">1234</td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="sendEmail()">
                    <i class="fas fa-envelope"></i> 메일 보내기
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
<!-- OrgChart JS -->
<script src="https://cdn.jsdelivr.net/npm/orgchart@3.1.3/dist/js/jquery.orgchart.min.js"></script>

<script>
// 조직도 데이터
var orgData = {
    'name': '대표이사',
    'title': 'CEO',
    'children': [
        {
            'name': '경영지원본부',
            'title': '본부장',
            'children': [
                { 'name': '인사팀', 'title': '팀장: 김철수' },
                { 'name': '총무팀', 'title': '팀장: 박민수' },
                { 'name': '재무팀', 'title': '팀장: 윤서연' }
            ]
        },
        {
            'name': 'IT본부',
            'title': '본부장',
            'children': [
                { 'name': '개발팀', 'title': '팀장: 정수진' },
                { 'name': '인프라팀', 'title': '팀장: 강민호' },
                { 'name': 'QA팀', 'title': '팀장: 오지훈' }
            ]
        },
        {
            'name': '영업본부',
            'title': '본부장',
            'children': [
                { 'name': '국내영업팀', 'title': '팀장: 황지현' },
                { 'name': '해외영업팀', 'title': '팀장: 손민정' },
                { 'name': '마케팅팀', 'title': '팀장: 조은비' }
            ]
        }
    ]
};

$(document).ready(function() {
    // 조직도 초기화
    $('#orgChart').orgchart({
        'data': orgData,
        'nodeContent': 'title',
        'verticalLevel': 3,
        'depth': 4,
        'pan': true,
        'zoom': true,
        'exportButton': true,
        'exportFilename': '조직도'
    });
});

// 전체 펼치기
function expandAll() {
    $('.orgchart').orgchart('expandAllNodes');
}

// 전체 접기
function collapseAll() {
    $('.orgchart .nodes').each(function() {
        if ($(this).closest('tr').siblings(':first').length) {
            $(this).find('.node:first').addClass('collapsed');
        }
    });
}

// 조직도 내보내기
function exportChart() {
    $('.orgchart').orgchart('export', {
        'filename': '조직도_' + new Date().toISOString().slice(0, 10)
    });
}

// 주소록 검색
function searchDirectory() {
    var searchTerm = $('#searchInput').val().toLowerCase();
    $('#directoryTable tr').each(function() {
        var rowText = $(this).text().toLowerCase();
        if (rowText.indexOf(searchTerm) !== -1) {
            $(this).show();
        } else {
            $(this).hide();
        }
    });
}

// 사용자 상세 정보 표시
function showUserDetail(userId) {
    // AJAX로 사용자 정보 조회 (예시)
    var userData = {
        1: { name: '김철수', dept: '인사팀', position: '팀장', email: 'kim@company.com', phone: '010-1234-5678', ext: '1234' },
        2: { name: '이영희', dept: '인사팀', position: '과장', email: 'lee@company.com', phone: '010-2345-6789', ext: '1235' },
        3: { name: '박민수', dept: '총무팀', position: '팀장', email: 'park@company.com', phone: '010-3456-7890', ext: '1236' }
    };
    
    var user = userData[userId];
    if (user) {
        $('#modalName').text(user.name);
        $('#modalDept').text(user.dept);
        $('#modalPosition').text(user.position);
        $('#modalEmail').text(user.email);
        $('#modalPhone').text(user.phone);
        $('#modalExt').text(user.ext);
        $('#userDetailModal').modal('show');
    }
}

// 메일 보내기
function sendEmail() {
    var email = $('#modalEmail').text();
    window.location.href = 'mailto:' + email;
}

// 검색 엔터키 이벤트
$('#searchInput').on('keypress', function(e) {
    if (e.which === 13) {
        searchDirectory();
    }
});
</script>
</th:block>
</body>
</html>